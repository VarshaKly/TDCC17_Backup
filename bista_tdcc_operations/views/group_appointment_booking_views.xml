<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<record id="tdcc_group_appointment_booking_tree" model="ir.ui.view">
		<field name="name">tdcc.group.appointment.booking.tree</field>
		<field name="model">group.appointment.booking</field>
		<field name="arch" type="xml">
			<tree string="Group Appointment Booking">
				<field name="name" />
				<field name="group_appointment_id" />
				<field name="client_ids" widget="many2many_tags" />
				<field name="group_size" />
				<field name="room_id" />
				<field name="physician_id" />
				<field name="state" />
			</tree>
		</field>
	</record>

	<record id="tdcc_group_appointment_booking_form" model="ir.ui.view">
		<field name="name">tdcc.group.appointment.booking.form</field>
		<field name="model">group.appointment.booking</field>
		<field name="arch" type="xml">
			<form string="Group Appointment Booking">
				<header>
					<button name="action_comfort_days" string="Select Comfort Date"
						type="object" states="draft" class="oe_highlight"
						groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cofounder,bista_tdcc_operations.group_tdcc_cre"/>
					<button name="action_confirm" string="Confirm" type="object"
						class="oe_highlight"
						groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre"
						attrs="{'invisible' : ['|', ('state', '!=','draft'),('date_generated', '=', False)]}"
						confirm="Are you sure you want to confirm this record ?" />
					<button name="%(bista_tdcc_operations.appointment_cancel_action)d"
						string="Cancel" type="action" states="draft,confirm,invoiced"
						class="oe_highlight"
						groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre"/>
					<button name="action_send_mail" string="Send Mail"
                        type="object" states="confirm" class="oe_highlight"/>
					<button name="action_set_to_draft" string="Set to draft"
						type="object" states="cancel" class="oe_highlight"
						groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre"/>
					<field name="state" widget="statusbar" statusbar_visible="draft,confirm"
						statusbar_colors='{"draft":"blue","confirm":"black"}'/>
				</header>
				<sheet>
					<h1>
						Group Appointment Booking
						<field name="name" class="oe_inline" readonly="1" />
					</h1>
					<group>
						<group>
							<field name="group_appointment_id" required="1"
								domain="[('state', '=', 'confirm')]" options="{'no_create':True,'no_open':True}"/>
							<field name="client_ids" required="1" widget="many2many_tags"
								domain="[('is_student','=',True)]"
								context="{'search_default_is_student':1,
                                          'show_address': 1}"
								options='{"always_reload": True}' />
							<field name="clinic_id" required="1" />
							<field name="group_size" required="1" />
							<field name="service_group_id" options="{'no_create':True,'no_open':True}"/>
							<field name="service_type_id" options="{'no_create':True,'no_open':True}"
								domain="[('service_group_id','=',service_group_id)]" />
							<field name="appointment_type_id" options="{'no_create':True,'no_open':True}"
								domain="[('service_type_id','=',service_type_id)]" />
							<field name="user_id" invisible="1" />
						</group>
						<group>
						    <field name="tdcc_group_appointment_booking_id"
						    invisible="1"/>
							<field name="room_id" domain="[('clinic_id', '=', clinic_id)]"
								required="1" options="{'no_create_edit': True}"/>
							<field name="physician_id" required="1" options="{'no_create_edit': True}"/>
							<field name="product_id" required="1" options="{'no_create_edit': True}"/>
							<field name="price_subtotal" readonly="1" force_save="1"/>
							<field name="allowed" invisible="1" />
							<field name="week_days_ids" widget="many2many_tags"
								required="1" options='{"no_create":True}' />
							<field name="date_generated" invisible="1" />
						</group>
					</group>
					<notebook>
						<page string="Dates">
							<field name="appointment_ids">
								<tree string="Dates" create="false"
									delete="false">
									<field name="name" />
									<field name="client_id" />
									<field name="appointment_date" />
									<field name="day" />
									<field name="start_time" widget="float_time" />
									<field name="end_time" widget="float_time" />
									<field name="physician_id" />
									<field name="room_id" />
									<field name="state" />
									<field name="invoice_count" invisible="1" />
									<button name="action_dna" string="DNA" type="object"
										icon="fa-stop-circle fa-lg" states="confirmed"
										confirm="Are you sure you want to make it as DNA ?"
										groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre"/>
									<button name="action_reschedule_appointment" string="Rearrange"
										type="object" states="confirmed,arrive" icon="fa-calendar"
										groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre"/>
									<button name="action_create_invoice" type="object"
										confirm="Are you sure you want to create invoice for this record ?"
										icon="fa-money fa-lg" states="confirmed" string="Create Invoice"
										help="Will create a invoice based on the details."
										groups="account.group_account_invoice"/>
									<button name="action_view_invoice" type="object" string="View Invoice"
										icon="fa-file-text fa-lg" attrs="{'invisible': [('invoice_count', '=', 0)]}" />
									<button name="action_request_cancel" string="Cancel"
										type="object" states="new,confirmed,arrive,dna" icon="fa-times-circle"
										style="font-size:20px;color:red"
										groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre"/>
								</tree>
							</field>
						</page>
						<page string="Cancellation" name="calcellation">
                            <field name="common_cancellation_ids" readonly="1">
                                <tree string="Days Cancelled">
                                    <field name="appointment_id"/>
                                    <field name="client_id"/>
                                    <field name="date" />
                                    <field name="day" />
                                    <field name="start_time" widget="float_time" />
                                    <field name="end_time" widget="float_time" />
                                    <field name="cancel_id" />
                                    <field name="write_by_id" />
                                </tree>
                            </field>
                        </page>
                        <page string="Rearrange" name="rearrange">
                            <field name="common_rearrangement_ids" readonly="1">
                                <tree string="Days Rearranged">
                                    <field name="appointment_id"/>
                                    <field name="client_id"/>
                                    <field name="start_date" />
                                    <field name="appointment_week_day" />
                                    <field name="start_time" widget="float_time" />
                                    <field name="end_time" widget="float_time" />
                                    <field name="rearrange_id" />
                                    <field name="write_by_id" />
                                    <field name="physician_id" />
                                </tree>
                            </field>
                        </page>
					</notebook>
				</sheet>
				 <div class="oe_chatter">
                        <field name="message_ids" widget="mail_thread" />
                </div>
			</form>
		</field>
	</record>

     <!-- Group Appointment Booking Search  View-->
        <record model="ir.ui.view" id="group_appointment_booking_search_view">
            <field name="name">group.appointment.booking.search</field>
            <field name="model">group.appointment.booking</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name" />
                    <field name="group_appointment_id"/>
                    <field name="physician_id" />
                    <field name="room_id" />
                    <field name="service_group_id"/>
                    <field name="service_type_id"/>
                    <field name="appointment_type_id"/>
                    <field name="group_size"/>
                    <field name="product_id"/>
                    <group expand="0" string="Group By">
                       <filter string="Group" name="group" domain="[]"
                            context="{'group_by':'group_appointment_id'}" />
                        <filter string="Status" name="state" domain="[]"
                            context="{'group_by':'state'}" />
                        <filter string="Physician" name="physician" domain="[]"
                            context="{'group_by':'physician_id'}" />
                        <filter string="Room" name="room" domain="[]"
                            context="{'group_by':'room_id'}" />
                        <filter string="Service Group" name="service_group"
                            domain="[]" context="{'group_by':'service_group_id'}" />
                        <filter string="Service Type" name="service_type"
                            domain="[]" context="{'group_by':'service_type_id'}" />
                        <filter string="Appointment Type" name="Appointment Type"
                            domain="[]" context="{'group_by':'appointment_type_id'}" />
                         <filter string="Price List" name="pricelist"
                            domain="[]" context="{'group_by':'product_id'}" />
                    </group>
                </search>
            </field>
        </record>
    
	<record id="action_tdcc_group_appointment_booking" model="ir.actions.act_window">
		<field name="name">Group Appointment Booking</field>
		<field name="res_model">group.appointment.booking</field>
		<field name="view_type">form</field>
		<field name="view_mode">tree,form</field>
		<field name="view_id" ref="tdcc_group_appointment_booking_tree" />
		<field name="domain">[('state','!=', 'cancel')]</field>
		<field name="help" type="html">
			<p class="oe_view_nocontent_create">
				Click to add a Group Appointment Booking.
			</p>
		</field>
	</record>

	<menuitem action="action_tdcc_group_appointment_booking" id="menu_action_group_appointment_booking_tdcc"
		parent="bista_tdcc_operations.appointment_menu" sequence="5"
		groups="bista_tdcc_operations.group_tdcc_director,bista_tdcc_operations.group_tdcc_cre,bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_cofounder,account.group_account_invoice,bista_tdcc_operations.group_tdcc_practitioner"/>


</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Daily Appointment List -->
    <record model="ir.ui.view" id="daily_appointment_tree">
        <field name="name">daily.appointment.tree</field>
        <field name="model">appointment.appointment</field>
        <field name="arch" type="xml">
            <tree string="Daily Appointment" create='false' delete='false' decoration-danger="state=='new'">
                <button name="action_send_appointment_mail"
                    string="Send Mail" type="object" icon="fa-send-o fa-lg"
                    states="confirmed,arrive,dna,invoiced"
                    confirm="Are you sure you want to send the Mail?"
                    groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre,bista_tdcc_operations.group_tdcc_practitioner" />
                <button name="action_view_appointment" type="object"
                    string="View Appointment" icon="fa-eye fa-lg" />
                <button name="action_appointment_confirm" string="Confirm"
                    type="object" states="new" icon="fa-arrow-right fa-lg"
                    help="Confirm"
                    groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre" />
                <button name="action_create_invoice" type="object"
                    confirm="Are you sure you want to create invoice for this record ?"
                    icon="fa-money fa-lg"
                    attrs="{'invisible': ['|', '|', ('state', 'not in', ('confirmed','arrive','dna')), ('hide_inv_btn','=',True), ('is_chargeable','=', 'non_chargeable')]}"
                    context="{'from_account': True}" string="Create Invoice"
                    help="Will create a invoice based on the details."
                    groups="account.group_account_invoice" />
                <button name="action_view_invoice" type="object"
                    string="View Invoice" icon="fa-file-text fa-lg"
                    attrs="{'invisible': [('invoice_count', '=', 0)]}"
                    groups="account.group_account_invoice,bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_cre,bista_tdcc_operations.group_tdcc_cofounder"/>
                <button name="action_student_arrive" string="Arrive"
                    type="object" attrs="{'invisible': ['|',('is_student_arrived','!=',False),
                    ('state','not in',('confirmed','invoiced'))]}" icon="fa-sign-in fa-lg"
                    context="{'from_physician': True}"
                    groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre,bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_practitioner"/>
                <button name="action_dna" string="DNA" type="object"
                    context="{'from_physician': True}" icon="fa-stop-circle fa-lg"
                    attrs="{'invisible': ['|',('is_student_arrived','!=',False), ('state','not in',('confirmed','invoiced'))]}"
                    confirm="Are you sure you want to make it as DNA ?"
                    groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_all_appointments,bista_tdcc_operations.group_tdcc_cre,bista_tdcc_operations.group_tdcc_practitioner" />
                <field name="name" />
                <field name="is_chargeable" invisible="1"/>
                <field name="hide_inv_btn" invisible="1"/>
                <field name="state" />
                <field name="client_id" />
                <field name="appointment_type_id" />
                <field name="attendant_id" />
                <field name="clinic_id" invisible="1" />
                <field name="physician_id" />
                <field name="service_type_id" />
                <field name="room_id" />
                <field name="price_subtotal" sum="Total Amount" />
                <field name="start_date" />
                <field name="duration" widget="float_time" />
                <field name="credit" />
                <field name="clinical_notes"/>
                <field name="is_student_arrived" invisible="1"/>
                <field name="invoice_state"
                    groups="bista_tdcc_operations.group_appointment_manager,bista_tdcc_operations.group_tdcc_cre,account.group_account_invoice" />
                <field name="invoice_count" invisible="1" />
            </tree>
        </field>
    </record>


    <!-- Daily Appointment Menu -->
    <record model="ir.actions.act_window"
        id="daily_appointment_view_action">
        <field name="name">Daily Appointments</field>
        <field name="res_model">appointment.appointment</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,calendar</field>
        <field name="view_id"
            ref="bista_tdcc_operations.daily_appointment_tree" />
    </record>

    <record id="action_daily_appointment_new_tree1"
        model="ir.actions.act_window.view">
        <field name="sequence">1</field>
        <field name="view_mode">tree</field>
        <field name="view_id"
            ref="bista_tdcc_operations.daily_appointment_tree" />
        <field name="act_window_id"
            ref="bista_tdcc_operations.daily_appointment_view_action" />
    </record>

    <record id="action_daily_appointment_new_calendar"
        model="ir.actions.act_window.view">
        <field name="sequence">2</field>
        <field name="view_mode">calendar</field>
        <field name="view_id"
            ref="bista_tdcc_operations.view_appointment_appointment_calendar_physician" />
        <field name="act_window_id"
            ref="bista_tdcc_operations.daily_appointment_view_action" />
    </record>

    <!-- Daily Appointment Menu -->
    <menuitem id="daily_appointment_menu"
        action="create_daily_appointment_action"
        parent="bista_tdcc_operations.appointment_menu" sequence="1"
        groups="bista_tdcc_operations.group_tdcc_practitioner,bista_tdcc_operations.group_tdcc_director,bista_tdcc_operations.group_tdcc_cofounder,bista_tdcc_operations.group_tdcc_cre,account.group_account_invoice,bista_tdcc_operations.group_appointment_manager" />

    <act_window id="send_sms_appointment_action"
        name="Send SMS"
        src_model="appointment.appointment"
        res_model="message.compose"
        view_type="form"
        view_mode="form"
        key2="client_action_multi"
        target="new"/>

    <act_window id="send_mail_daily_appointment_action"
        name="Send Mail"
        src_model="appointment.appointment"
        res_model="mail.compose.message"
        view_type="form"
        context= "
                {'default_composition_mode': 'mass_mail',
                 'default_use_template': True,
                 'default_template_id': ref('bista_tdcc_operations.appointment_reminder_mail_template'),
                 'default_email_to': '${object.client_id.email'}"
        view_mode="form"
        key2="client_action_multi"
        target="new"/>

</odoo>
